build --config=clang
# Define a macro used in psp-sev.h
build --per_file_copt=psp-sev.,.kernel_api.,.launcher.@-D__packed=__attribute__((__packed__))
# Use nightly rustc by default
build --@rules_rust//rust/toolchain/channel=nightly
build --config=rustfmt
# Hide warnings for external libraries
# external_include_paths actually stops warnings (helps with stricter build flags), but seems to only be for .h files, not most .cc files.
build --output_filter='^//((?!(external):).)*$'
# Prevent Bazel from detecting the system's C++ toolchain.
build --action_env=BAZEL_DO_NOT_DETECT_CPP_TOOLCHAIN=1
build --incompatible_strict_action_env=true
# Enable the CC toolchain resolution based on platforms.
build --incompatible_enable_cc_toolchain_resolution
build --verbose_failures

test --test_output=errors

build:clang --cxxopt='-std=c++20'
build:clang --host_cxxopt='-std=c++20'
build:clang --cxxopt='-Wswitch'
build:clang --cxxopt='-Werror=switch'

build:rustfmt --aspects=@rules_rust//rust:defs.bzl%rustfmt_aspect
build:rustfmt --output_groups=+rustfmt_checks
