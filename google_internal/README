# This is for Google internal used assets only

## RBE

One time gcloud setup:
1. If you can't run `gcloud`, install it with `sudo apt install google-cloud-cli`
1. `gcloud config set account ${USER}@google.com`
1. `gcloud config set project kiwi-air-force-remote-build`
1. `gcloud auth application-default login`
    - Run whenever `bazel_rbe` gives an error about metadata
    - follow the steps (chrome popup or link)
    - Can ignore warning about kiwi quota
1. `bazel shutdown`
    - This needs to be done every time after the above step to make the bazel recognize the credentials

For each shell that you run bazel in (directly or indirectly):
- run `source google_internal/rbe_setup.sh`.

Then, use `bazel_rbe` in place of `bazel` to utilize Kiwi's RBE to speed up building.
For example, `bazel_rbe test //...`
When building you should see **remote cache hit** in the bazel output.
This holds even when running local `bazel clean`.

In the future, this may also matter/help when using `builders` locally
The current version does not do any builders image pulling, but the original kiwi version does.

## Future work

* Fixed toolchain to improve caching
* docker images (builders)
* Cache just toolchain, not build files (or only if hash same), so that presubmit is on fresh cache

* Figure out how remote execution works. How does it get versions of e.g. c++
